# خطة عمل: اختبار الموقع بالكامل وتسليمه للزبون دون ملاحظات

## الهدف
التأكد من عمل الموقع 100% في كل الصفحات والأزرار والوظائف، ثم تسليمه للزبون جاهزاً للاستخدام.

---

## المرحلة 0: إعداد البيئة (قبل أي اختبار)

### 0.1 إيقاف السيرفر وإغلاق المشروع
- [ ] إيقاف `npm run dev` إن كان يعمل (إغلاق الطرفية أو Ctrl+C).
- [ ] إن كان المشروع داخل **OneDrive**: نقل المجلد إلى مكان خارج OneDrive (مثل `C:\Projects\silver`) لتجنب أخطاء **EBUSY** وملفات مقفلة أثناء التشغيل والبناء.

### 0.2 المتطلبات
- [ ] **Node.js** (مثلاً 18 أو 20) مثبت.
- [ ] ملف **`.env`** موجود في جذر المشروع ويحتوي على:
  - `DATABASE_URL` — رابط قاعدة البيانات (PostgreSQL، مثلاً Supabase أو Neon).
  - `NEXT_PUBLIC_SUPABASE_URL` و `NEXT_PUBLIC_SUPABASE_ANON_KEY` — من مشروع Supabase (لوحة التحكم → Settings → API).
- [ ] **قاعدة البيانات:** تنفيذ الهجرات وتهيئة الجداول:
  ```bash
  npx prisma generate
  npx prisma db push
  ```
- [ ] (اختياري) بيانات تجريبية: `npm run db:seed`.

### 0.3 البناء والتشغيل
- [ ] حذف مجلد `.next` إن وجد: `Remove-Item -Recurse -Force .next`
- [ ] تشغيل البناء: `npm run build` — يجب أن يكتمل بدون أخطاء.
- [ ] تشغيل الموقع: `npm run start` (أو `npm run dev` للاختبار).
- [ ] فتح المتصفح على: **http://localhost:3000**

---

## المرحلة 1: اختبار واجهة المتجر (الزبون)

### 1.1 الصفحة الرئيسية `/`
- [ ] الصفحة تفتح بدون خطأ.
- [ ] الهيرو (Hero) يظهر مع النص والزر.
- [ ] التصنيفات المميزة تظهر (أو رسالة مناسبة إن لم يكن هناك بيانات).
- [ ] المنتجات المميزة تظهر (أو رسالة مناسبة).
- [ ] قسم الثقة (Trust) يظهر.
- [ ] **الرأس (Header):** الروابط "الرئيسية"، "المتجر"، "السلة" تعمل.
- [ ] أيقونة البحث تؤدي للمتجر.
- [ ] أيقونة السلة تفتح `/cart`.
- [ ] تبديل الوضع الفاتح/الداكن (إن وجد) يعمل.
- [ ] **الفوتر** يظهر بشكل صحيح.

### 1.2 صفحة المتجر `/shop`
- [ ] الصفحة تفتح.
- [ ] قائمة المنتجات تظهر (أو "لا توجد منتجات").
- [ ] الفلاتر (تصنيف، نوع، إلخ) تعمل وتحدّث النتائج.
- [ ] النقر على منتج يفتح صفحة المنتج `/product/[slug]`.

### 1.3 صفحة منتج واحد `/product/[slug]`
- [ ] الصفحة تفتح للمنتج المختار.
- [ ] الصور تظهر وتبديل الصور يعمل.
- [ ] الاسم، الوصف، السعر، الوزن تظهر بوضوح.
- [ ] اختيار الكمية يعمل.
- [ ] زر **"إضافة إلى السلة"** يعمل وتُضاف الكمية المختارة.
- [ ] روابط المنتجات ذات الصلة تعمل.

### 1.4 صفحة السلة `/cart`
- [ ] الصفحة تفتح.
- [ ] المنتجات المضافة تظهر مع السعر والكمية والإجمالي.
- [ ] تغيير الكمية يعمل (زيادة/نقصان).
- [ ] حذف منتج من السلة يعمل.
- [ ] زر **"إتمام الطلب"** (أو ما يعادل ذلك) ينتقل لصفحة الدفع.

### 1.5 صفحة الدفع / إتمام الطلب `/checkout`
- [ ] الصفحة تفتح.
- [ ] الحقول: الاسم، الهاتف، العنوان، الملاحظات تظهر وتقبل إدخالاً.
- [ ] ملخص الطلب (العناصر والمجموع) صحيح.
- [ ] زر **"تأكيد الطلب"** يرسل الطلب ويظهر تأكيد (رسالة نجاح أو تحويل).
- [ ] السلة تُفرغ بعد الطلب الناجح (إن كان التصميم يفترض ذلك).

---

## المرحلة 2: اختبار لوحة التحكم (الأدمن)

### 2.1 تسجيل الدخول `/admin/login`
- [ ] الصفحة تفتح.
- [ ] إدخال بريد وكلمة مرور **مسجّلين في Supabase (Auth)** يعمل.
- [ ] بعد النجاح يتم التحويل إلى `/admin`.
- [ ] رسالة الخطأ تظهر بشكل واضح عند فشل تسجيل الدخول.

### 2.2 لوحة التحكم الرئيسية `/admin`
- [ ] بعد الدخول تظهر الإحصائيات (منتجات، تصنيفات، أنواع، طلبات).
- [ ] الشريط الجانبي يظهر مع كل الروابط.
- [ ] الروابط: لوحة التحكم، المنتجات، التصنيفات، الأنواع، الطلبات — كلها تعمل.
- [ ] زر "تسجيل الخروج" يعمل ويُعيد إلى `/admin/login`.
- [ ] رابط "العودة للمتجر" يفتح الصفحة الرئيسية للمتجر.

### 2.3 المنتجات `/admin/products`
- [ ] جدول المنتجات يظهر (صورة، اسم، تصنيف، نوع، سعر، حالة، إجراءات).
- [ ] زر **"إضافة منتج"** يفتح `/admin/products/new`.
- [ ] زر **"تعديل"** لكل منتج يفتح `/admin/products/[id]`.

### 2.4 إضافة منتج `/admin/products/new`
- [ ] النموذج يظهر بكل الحقول (الاسم، الوصف، الوزن، السعر، التصنيف، النوع، الجنس، نوع الحجر، نقاء الفضة، نشط، مميز).
- [ ] الحقول الإلزامية لا تسمح بالإرسال فارغة.
- [ ] زر **"إضافة المنتج"** يحفظ المنتج ويحوّل لصفحة المنتج أو قائمة المنتجات.
- [ ] زر **"إلغاء"** يعيد دون حفظ.

### 2.5 تعديل منتج `/admin/products/[id]`
- [ ] بيانات المنتج تُحمّل في النموذج.
- [ ] التعديل والحفظ يعملان.
- [ ] إدارة الصور (رفع، تعيين رئيسية، حذف، ترتيب) تعمل إن وُجدت.

### 2.6 التصنيفات `/admin/categories`
- [ ] جدول التصنيفات يظهر.
- [ ] زر **"إضافة تصنيف"** يفتح نافذة/صفحة ويُكمل الإضافة.
- [ ] زر **"تعديل"** يفتح نافذة التعديل والحفظ يعمل.
- [ ] زر **"حذف"** يعمل مع تأكيد.

### 2.7 الأنواع `/admin/types`
- [ ] نفس الاختبارات كما في التصنيفات (إضافة، تعديل، حذف).

### 2.8 الطلبات `/admin/orders`
- [ ] جدول الطلبات يظهر (تاريخ، عميل، هاتف، مبلغ، حالة، إجراءات).
- [ ] زر **"عرض"** يفتح تفاصيل الطلب.

### 2.9 تفاصيل طلب `/admin/orders/[id]`
- [ ] معلومات العميل (الاسم، الهاتف، العنوان، الملاحظات) تظهر.
- [ ] عناصر الطلب والمجموع تظهر.
- [ ] تغيير **حالة الطلب** (قائمة منسدلة أو أزرار) يعمل ويُحفظ.
- [ ] رابط **"العودة للطلبات"** يعمل.

---

## المرحلة 3: التحقق التقني

### 3.1 البناء والإنتاج
- [ ] `npm run build` ينجح بدون أخطاء TypeScript أو Lint.
- [ ] `npm run start` يشغّل الموقع وكل الصفحات الأساسية تعمل.

### 3.2 الحماية والصلاحيات
- [ ] الدخول إلى `/admin` بدون تسجيل دخول يُعيد التوجيه إلى `/admin/login`.
- [ ] بعد تسجيل الخروج لا يمكن الوصول لصفحات الأدمن بدون تسجيل دخول من جديد.

### 3.3 الأخطاء
- [ ] صفحة منتج غير موجود (slug خاطئ) تعرض 404 أو "غير موجود".
- [ ] عند انقطاع قاعدة البيانات تظهر رسالة واضحة (بدون كشف تفاصيل تقنية للزبون).

---

## المرحلة 4: الجاهزية للتسليم

### 4.1 قائمة تسليم للزبون
- [ ] الموقع يعمل محلياً (أو على الاستضافة) كما في المراحل 1–3.
- [ ] توثيق مختصر يتضمن:
  - رابط الموقع (أو تعليمات التشغيل).
  - رابط لوحة التحكم وطريقة تسجيل الدخول (إنشاء مستخدم في Supabase إن لزم).
  - ضرورة وجود `.env` وقاعدة البيانات و Supabase بشكل صحيح.
- [ ] التأكد من أن **ملف `.env` غير مرفوع** على GitHub (موجود في `.gitignore`).

### 4.2 استضافة (إن وُجدت)
- [ ] ربط المستودع (مثلاً GitHub) بالاستضافة (Vercel / غيرها).
- [ ] إضافة متغيرات البيئة (DATABASE_URL, Supabase) في إعدادات المشروع.
- [ ] التأكد من أن البناء على الاستضافة ينجح وأن الموقع يعمل بعد النشر.

---

## ملاحظات سريعة لمعالجة "الموقع لا يعمل"

| المشكلة | الإجراء |
|--------|---------|
| **EBUSY / resource busy** | نقل المشروع خارج OneDrive وعدم تشغيل البناء أو السيرفر من مجلد مزامن. |
| **صفحة بيضاء أو خطأ** | فتح أدوات المطور (F12) وقراءة رسالة الخطأ في Console و Network. |
| **لا يمكن تسجيل الدخول للأدمن** | التأكد من إنشاء مستخدم في Supabase Authentication واستخدام نفس البريد/كلمة المرور. |
| **قاعدة البيانات لا تتصل** | التحقق من `DATABASE_URL` في `.env` وتشغيل `npx prisma db push`. |
| **البناء يفشل** | تشغيل من مجلد خارج OneDrive، حذف `.next` ثم `npm run build` من جديد. |

---

## خلاصة

1. **أغلق المشروع** (أوقف السيرفر).
2. **انقل المشروع خارج OneDrive** إن أمكن لتجنب أخطاء الملفات المقفلة.
3. **تأكد من `.env` وقاعدة البيانات و Supabase** ثم نفّذ المراحل 0 → 1 → 2 → 3 بالترتيب.
4. استخدم هذه الوثيقة كـ **قائمة تحقق (Checklist)** وعلّم كل بند بعد اختباره.
5. بعد اكتمال المراحل 1–3 و 4.1 يكون الموقع جاهزاً **لتسليمه للزبون دون ملاحظات** من ناحية الوظائف والاستقرار.

# تقرير اختبار الموقع — قسم الاختبار (QA)

**التاريخ:** 22 فبراير 2025  
**المشروع:** فضة بغداد (Silver Jewelry Baghdad)  
**البيئة:** Next.js 14، Prisma، Supabase، المنفذ 3002

---

## 1. ربط البيانات (Data Binding & Connectivity)

### ✅ ما يعمل بشكل جيد
- **Prisma:** الاتصال بقاعدة البيانات يعمل؛ استعلامات الصفحة الرئيسية والمتجر تُنفَّذ بنجاح.
- **السلة (Zustand + persist):** حالة السلة محفوظة في `localStorage` تحت المفتاح `silver-cart`، فلا تضيع عند تحديث الصفحة.
- **لوحة التحكم:** الحماية عبر `(dashboard)/layout.tsx` — إعادة توجيه إلى `/admin/login` عند عدم تسجيل الدخول.
- **صفحة المنتج:** عند فشل قاعدة البيانات تظهر `DbErrorBanner` مع رسالة واضحة وزر عودة.

### ⚠️ ملاحظات وأخطاء
| المشكلة | الوصف | التوصية |
|--------|--------|----------|
| **صور Unsplash 404** | السيرفر يسجّل: `upstream image response failed for https://images.unsplash.com/photo-1611652022419-a5819e42a7c3?w=800&q=85` (404). الرابط مستخدم في الـ seed لصورة الأساور (`bracelet`). | استبدال الرابط في `prisma/seed.ts` بصورة تعمل، أو استخدام صور من Supabase Storage بعد الرفع. |
| **استجابة خطأ الطلب في إتمام الطلب** | API الطلبات (`/api/orders`) يعيد عند التحقق الفاشل: `{ error: fieldErrors }` (Zod). لكن صفحة الـ checkout لا تعرض هذه الأخطاء — تستخدم فقط `alert("حدث خطأ. حاول مرة أخرى.")` ولا تظهر أخطاء الحقول (مثلاً: حقل مطلوب فارغ). | في `app/checkout/page.tsx`: قراءة `res.json()` عند `!res.ok` وعرض `fieldErrors` للمستخدم تحت الحقول أو في رسالة واحدة. |
| **لا يوجد تحقق من صحة الهاتف** | حقل الهاتف `customerPhone` مطلوب فقط كـ string غير فارغ، بدون تنسيق (مثلاً 07XXXXXXXX). | إضافة تحقق (Zod أو regex) لتنسيق رقم عراقي وربما عرض تلميح في الواجهة. |

---

## 2. سرعة الموقع (Performance)

### ✅ ما يعمل بشكل جيد
- **الصفحة الرئيسية:** طلب واحد للصفحة يعود 200؛ استخدام Server Components لجلب التصنيفات والمنتجات المميزة.
- **المتجر:** وجود `Suspense` مع `ShopSkeleton` يمنح تجربة تحميل أفضل أثناء جلب المنتجات.
- **الصور:** استخدام `next/image` مع `sizes` و`priority` للمنتجات الأولى؛ lazy loading لباقي الصور.
- **استعلامات المتجر:** استخدام `Promise.all` لجلب التصنيفات والأنواع معاً في `ShopContent`.

### ⚠️ ملاحظات
| المشكلة | الوصف | التوصية |
|--------|--------|----------|
| **زمن التحميل الأول للصفحة الرئيسية** | في التطوير: أول طلب لـ `/` استغرق ~8 ثوانٍ (Compiled / in 7966ms) بسبب تجميع الصفحة. في الإنتاج (`npm run build` ثم `start`) يكون أسرع. | التأكد من تشغيل `npm run build` قبل القياس؛ استخدام تحليلات (مثل Lighthouse) على بيئة الإنتاج. |
| **تحذير webpack** | `Serializing big strings (133kiB) impacts deserialization performance` — قد يؤثر على زمن البناء/إعادة التحميل. | مراجعة أي ملفات كبيرة تُمرَّر في الـ cache؛ تقليل حجم الـ payload إن أمكن. |
| **لا توجد صفحات loading.tsx / error.tsx** | لا يوجد تحميل على مستوى المسار (route-level) ولا واجهة خطأ عامة. | إضافة `app/loading.tsx` و`app/error.tsx` (وربما لـ `/shop`, `/cart`) لتحسين الإحساس بالسرعة وتجربة الخطأ. |

---

## 3. سهولة الاستخدام (Usability)

### ✅ ما يعمل بشكل جيد
- **التنقل:** الروابط الرئيسية (الرئيسية، المتجر، السلة) واضحة في الهيدر.
- **أزرار الهيرو:** "تصفح المتجر"، "نساء"، "رجال" توجّه مباشرة للمتجر مع فلتر.
- **السلة:** تغيير الكمية (+/−) وإزالة المنتج واضح؛ ملخص المجموع والوزن ظاهر.
- **صفحة المنتج:** اختيار الكمية وزر "أضف إلى السلة" واضحان؛ وجود منتجات ذات صلة.
- **لوحة التحكم:** شريط جانبي مع روابط المنتجات، التصنيفات، الأنواع، الطلبات.

### ⚠️ ملاحظات
| المشكلة | الوصف | التوصية |
|--------|--------|----------|
| **أيقونة البحث** | زر البحث في الهيدر يوجّه فقط إلى `/shop` ولا يفتح حقل بحث. | إما إضافة بحث فعلي (المتجر يدعم `?q=`) مع حقل في الهيدر أو في صفحة المتجر، أو تغيير النص/الأيقونة لـ "المتجر" إن كان المقصود التوجيه فقط. |
| **عدم وجود تأكيد عند الإضافة للسلة** | عند النقر "أضف إلى السلة" لا تظهر toast أو رسالة تأكيد. | إضافة إشعار قصير (مثلاً toast أو نص يظهر لثوانٍ) "تمت الإضافة إلى السلة". |
| **صفحة إتمام الطلب عند الخطأ** | عند فشل الإرسال يظهر فقط `alert`. المستخدم لا يرى أي تفاصيل (حقول ناقصة، خطأ شبكة). | عرض رسالة الخطأ داخل الصفحة (وأفضل عرض أخطاء الحقول بجانب كل حقل). |
| **لا صورة في السلة** | عندما `item.imageUrl` null يظهر نص "لا صورة" فقط. | استخدام صورة افتراضية `placeholder-product.svg` أو أيقونة منتج لتحسين المظهر. |

---

## 4. تجربة المستخدم (UX)

### ✅ ما يعمل بشكل جيد
- **RTL و العربية:** `dir="rtl"` وخط Tajawal يعطيان تجربة عربية مناسبة.
- **الوضع الفاتح/الداكن:** ThemeToggle متوفر ويعمل.
- **السلة الفارغة / طلب مكتمل:** رسائل واضحة ("السلة فارغة"، "تم استلام طلبك") مع أزرار مناسبة.
- **صفحة 404 للمنتج:** استخدام `notFound()` عند عدم وجود منتج يعطي صفحة 404 من Next.js.

### ⚠️ ملاحظات
| المشكلة | الوصف | التوصية |
|--------|--------|----------|
| **لا feedback بعد تأكيد الطلب** | بعد النجاح يتم `clearCart()` ثم `router.push("/")`. المستخدم يرى الصفحة الرئيسية فوراً دون رسالة "شكراً" على نفس الصفحة. | الكود يعرض حالياً `done` محلياً ثم يوجّه — التأكد من أن المستخدم يرى شاشة "تم استلام طلبك" قبل الانتقال، أو إبقاؤه عليها مع زر "العودة للمتجر". (مراجعة الكود: يبدو أن `setDone(true)` ثم `router.push("/")` ينفّذان معاً؛ قد لا يظهر "تم استلام طلبك" إذا كان الانتقال سريعاً — يُفضّل الانتقال إلى صفحة تأكيد مخصصة أو عرض النجاح ثم الانتقال بعد ثانية.) |
| **حقل الكمية في صفحة المنتج** | استخدام `<input type="number">` مع `onChange` — إدخال قيم غير صحيحة (مثلاً 0 أو سالب) يُصحَّح إلى 1. جيد، لكن لا حد أقصى. | اختياري: حد أقصى للكمية (مثلاً 10) أو على الأقل منع أرقام غير معقولة. |
| **الفوتر بسيط جداً** | فقط حقوق نشر ونص واحد. | اختياري: إضافة روابط (متجر، تواصل، سياسة الخصوصية) إن وُجدت. |

---

## 5. التصميم (Design)

### ✅ ما يعمل بشكل جيد
- **هيكل الصفحة:** هيدر ثابت، محتوى رئيسي، فوتر.
- **البطاقات (ProductCard):** حدود، ظل، hover (scale + shadow)، شارة "مميز".
- **صفحة المنتج:** شبكة مناسبة (صورة كبيرة + مصغرات، تفاصيل بجانبها).
- **لوحة التحكم:** شريط جانبي + منطقة محتوى؛ ألوان Slate منفصلة عن واجهة المتجر.

### ⚠️ ملاحظات
| المشكلة | الوصف | التوصية |
|--------|--------|----------|
| **تناسق الألوان بين المتجر والأدمن** | المتجر يستخدم `silver-*` و `accent` (أخضر). لوحة التحكم تستخدم `slate-*` و `bg-slate-50`. | اختياري: توحيد الباليت أو التأكد أن الفصل مقصود (علامة تجارية للمتجر vs أدمن). |
| **زر "إزالة" في السلة** | يستخدم `variant="ghost"` و `text-red-600` — جيد للتمييز. | يمكن جعله أوضح قليلاً (مثلاً أيقونة سلة مهملة) إن رغبت. |
| **صورة الهيرو** | خلفية من Unsplash عبر `style={{ backgroundImage: "url(...)" }}` — لا تمرّ عبر `next/image` فلا تحصل على تحسين تلقائي. | إن أمكن، استبدالها بـ `next/image` مع `fill` و priority أو على الأقل التأكد أن الرابط يعمل دائماً. |

---

## 6. الألوان (Colors)

### ✅ ما يعمل بشكل جيد
- **المتغيرات في globals.css:** `--accent`, `--accent-light`, `--accent-dark` للوضع الفاتح، ونظائرها في `.dark` (أخضر/تركواز).
- **Silver:** `--silver-50` إلى `--silver-900` للنصوص والخلفيات والحدود.
- **الوضع الداكن:** خلفية `#121214`، نصوص فاتحة، حدود وتمييز جيد.
- **التمييز:** السعر والروابط النشطة بلون accent؛ النص الثانوي بـ `text-silver-600` / `text-muted`.

### ⚠️ ملاحظات
| المشكلة | الوصف | التوصية |
|--------|--------|----------|
| **قيم ثابتة بجانب المتغيرات** | بعض المكونات تستخدم قيماً ثابتة مثل `dark:bg-[#121214]`, `dark:bg-[#1a1a1d]`, `dark:bg-[#252528]` بدلاً من متغيرات CSS. | نقلها إلى متغيرات (مثلاً `--bg-page`, `--card-bg`) لسهولة التعديل والتناسق. |
| **التباين** | الألوان الحالية تبدو مناسبة للقراءة. | مراجعة تباين النص مع الخلفية (مثلاً WCAG) خاصة في الوضع الداكن للروابط الصغيرة. |

---

## 7. تفاصيل إضافية

### أمان وصلاحيات
- مسارات `/admin` (ما عدا `/admin/login`) محمية عبر layout يتحقق من Supabase Auth.
- ملف `.env` يجب أن يكون في `.gitignore` (التحقق من ذلك).

### قاعدة البيانات والـ Seed
- صور الـ seed تعتمد على روابط Unsplash؛ أحدها (bracelet) يعيد 404. إما تحديث الرابط أو الاعتماد على صور مرفوعة بعد النشر.

### البناء والإنتاج
- وفق README: `npm run build` ناجح. للتشغيل: `npm run start` أو `npm run dev`. إن كان المنفذ 3000 مستخدماً، Next يحاول 3001 ثم 3002.

### قائمة تحقق سريعة
- [ ] إصلاح صورة Unsplash 404 في الـ seed (أو استبدالها).
- [ ] عرض أخطاء التحقق من API الطلبات في صفحة إتمام الطلب.
- [ ] إضافة تأكيد (toast/رسالة) عند "أضف إلى السلة".
- [ ] توضيح سلوك زر البحث (بحث فعلي أو مجرد رابط للمتجر).
- [ ] إضافة `loading.tsx` و `error.tsx` على مستوى التطبيق أو المسارات الحرجة.
- [ ] استخدام placeholder للسلة عندما `imageUrl` null.
- [ ] (اختياري) توحيد أو توثيق استخدام الألوان الثابتة vs متغيرات CSS.

---

**خلاصة:** الموقع يعمل من ناحية الربط والتدفق الرئيسي (الرئيسية، المتجر، المنتج، السلة، إتمام الطلب، لوحة التحكم). أهم التحسينات: معالجة صورة الـ seed المعطوبة، تحسين عرض أخطاء إتمام الطلب، وإضافة feedback عند الإضافة للسلة ووضع loading/error عام أفضل.
